<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MainDAO">

	<select id="selectIdChk" parameterType="java.util.HashMap" resultType="int">
		SELECT count(1)
		FROM tb_member
		WHERE member_id = #{accountId}
	</select>
	
	<insert id="insertMember" parameterType="java.util.HashMap">
	INSERT INTO tb_member
	(
		member_id,
		member_pw,
		member_name,
		member_birth,
		member_email,
		create_id,
		update_id)
	VALUES (
		#{accountId},
		#{accountPwd},
		#{accountName},
		#{accountBirth},
		#{accountEmail},
		#{accountId},
		#{accountId}
	)
	</insert>
	
	<select id="selectLoginInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT  member_idx AS memberIdx,
				member_id AS id,
				member_name AS name,
				member_birth AS birth,
				member_email AS email,
				left(member_email, locate('@', member_email)-1) AS emailId,
				substring(member_email, locate('@', member_email)+1) AS emailAddr,
				member_use_yn AS useYn
		FROM tb_member
		WHERE member_id = #{id}
		AND member_pw = #{pwd}
		AND member_use_yn = 'Y'
		
	</select>
	
	<update id="updateMember" parameterType="java.util.HashMap">
		update tb_member
		<set>

			member_name = #{accountName},
			member_birth = #{accountBirth},
			member_email = #{accountEmail},
			update_id = #{accountId},
			update_date = current_timestamp()
			<if test="accountPwd != null and accountPwd !='' and accountPwd !='undefined'">
				,member_pw = #{accountPwd},
			</if>
		</set>
		where member_idx = #{memberIdx}
	</update>
	
<select id="selectMemberInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select member_idx as memberIdx,
			   member_id as id,
			   member_name as name,
			   member_birth as birth,
			   member_email as email,
			   left(member_email, locate('@', member_email)-1) as emailId,
	   		   substring(member_email, locate('@', member_email)+1) as emailAddr,
			   member_use_yn as useYn
		from tb_member
		where member_idx = #{memberIdx}
		
</select>
<update id="deleteMemberInfo" parameterType="int">
	update tb_member
	set member_use_yn = 'N'
	where member_idx = #{memberIdx}
</update>

<select id="selectFindId" parameterType="java.util.HashMap" resultType="String" >
	select member_id
	from tb_member
	where member_name = #{memberName}
	and member_email = #{memberEmail}
</select>

<!-- 인증하는 쿼리 -->
<select id="selectMemberCertification" parameterType="java.util.HashMap" resultType="int" >  
	select member_idx
	from tb_member
	where member_id = #{memberId}
	and member_name = #{memberName}
	and member_email = #{memberEmail}
</select>

<select id="selectMemberCertificationChk" parameterType="java.util.HashMap" resultType="int" >  
	select count(member_idx)
	from tb_member
	where member_id = #{memberId}
	and member_name = #{memberName}
	and member_email = #{memberEmail}
</select>

<update id="updatePwd" parameterType="java.util.HashMap">
	update tb_member
	set member_pw = #{memberPw}
	where member_idx = #{memberIdx}
</update>
	
	
</mapper>